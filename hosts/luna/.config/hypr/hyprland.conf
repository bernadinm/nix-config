# Hyprland configuration file
# This configuration replicates i3 tiling workflow

# Variables
$mod = ALT
$sup = SUPER

# Environment variables
env = XCURSOR_THEME,Bibata-Modern-Classic
env = XCURSOR_SIZE,24

# Force dark theme for all apps
env = GTK_THEME,Catppuccin-Mocha-Standard-Mauve-Dark
env = QT_QPA_PLATFORMTHEME,gtk3

# XDG Desktop Portal for screen sharing and remote desktop
env = XDG_CURRENT_DESKTOP,Hyprland
env = XDG_SESSION_TYPE,wayland
env = XDG_SESSION_DESKTOP,Hyprland

# Font settings
exec-once = gsettings set org.gnome.desktop.interface monospace-font-name 'monospace 8'
exec-once = gsettings set org.gnome.desktop.interface font-name 'monospace 8'

# Monitor setup
monitor=,preferred,auto,1

# Window rules
windowrulev2 = noborder, title:^(.*)$
windowrulev2 = float, class:^(float)$
windowrulev2 = float, title:^(scratchpad)$
windowrulev2 = workspace special, class:^(float)$

# Firefox - no transparency
windowrulev2 = opacity 1.0 override 1.0 override, class:^(firefox)$
windowrulev2 = opacity 1.0 override 1.0 override, class:^(Firefox)$

# Input configuration
input {
    kb_layout = us
    kb_variant =
    kb_model =
    kb_options = ctrl:swap_lalt_lwin
    kb_rules =

    sensitivity = 0.0
    repeat_rate = 50
    repeat_delay = 300

    # Touchpad settings
    touchpad {
        natural_scroll = true
        tap-to-click = true
        drag_lock = false
        disable_while_typing = true
        clickfinger_behavior = true
    }
}

# Gestures - touchpad workspace switching
gestures {
    # workspace_swipe = true
    # workspace_swipe_fingers = 3
    workspace_swipe_distance = 300
    workspace_swipe_invert = true
    workspace_swipe_cancel_ratio = 0.5
    workspace_swipe_create_new = false
}

# General settings - matching i3 gaps with Catppuccin Mocha colors
general {
    gaps_in = 12
    gaps_out = 0
    border_size = 2
    allow_tearing = false
    col.active_border = rgba(cba6f7ff) rgba(89b4faff) 45deg  # Catppuccin Mocha - Mauve to Blue gradient
    col.inactive_border = rgba(313244ff)  # Catppuccin Mocha - Surface0
    layout = dwindle
}

# dwindle options (i3-like split behavior)
dwindle {
    pseudotile = yes
    preserve_split = yes
    force_split = 2  # always split to the right/bottom
    special_scale_factor = 0.8
}

# master layout options
master {
    new_on_top = true
    mfact = 0.5
}

# Window decorations - Catppuccin Mocha
decoration {
    rounding = 0
    active_opacity = 0.95
    inactive_opacity = 0.85

    blur {
        enabled = true
        size = 6
        passes = 2
        new_optimizations = true
        ignore_opacity = true
    }

    shadow {
        enabled = true
        range = 12
        render_power = 3
        color = rgba(11111bcc)  # Catppuccin Mocha - Crust with transparency
        sharp = false
    }
}

# Animation
animations {
    enabled = true
    bezier = default, 0.05, 0.9, 0.1, 1.0

    animation = windows, 1, 3, default
    animation = windowsOut, 1, 3, default, popin 80%
    animation = border, 1, 5, default
    animation = fade, 1, 5, default
    animation = workspaces, 1, 3, default
}

# ============================================
# KEYBINDINGS - Matching i3 workflow
# ============================================

# Terminal
bind = $mod, Return, exec, alacritty

# Close window (i3: $mod+Shift+w)
bind = $mod SHIFT, W, killactive,

# Program launcher (i3: $mod+space)
bind = $mod, SPACE, exec, wofi --show drun

# Clipboard history (Super+V)
bind = $sup, V, exec, cliphist list | wofi --dmenu | cliphist decode | wl-copy

# Focus movement (vim keys)
bind = $mod, H, movefocus, l
bind = $mod, J, movefocus, d
bind = $mod, K, movefocus, u
bind = $mod, L, movefocus, r

# Focus movement (arrow keys)
bind = $mod, LEFT, movefocus, l
bind = $mod, DOWN, movefocus, d
bind = $mod, UP, movefocus, u
bind = $mod, RIGHT, movefocus, r

# Move windows (vim keys)
bind = $mod SHIFT, H, movewindow, l
bind = $mod SHIFT, J, movewindow, d
bind = $mod SHIFT, K, movewindow, u
bind = $mod SHIFT, L, movewindow, r

# Move windows (arrow keys)
bind = $mod SHIFT, LEFT, movewindow, l
bind = $mod SHIFT, DOWN, movewindow, d
bind = $mod SHIFT, UP, movewindow, u
bind = $mod SHIFT, RIGHT, movewindow, r

# Workspaces
bind = $mod, 1, workspace, 1
bind = $mod, 2, workspace, 2
bind = $mod, 3, workspace, 3
bind = $mod, 4, workspace, 4
bind = $mod, 5, workspace, 5
bind = $mod, 6, workspace, 6
bind = $mod, 7, workspace, 7
bind = $mod, 8, workspace, 8
bind = $mod, 9, workspace, 9
bind = $mod, 0, workspace, 10

# Move to workspace (using keycodes for reliability)
bind = $mod SHIFT, code:10, movetoworkspace, 1
bind = $mod SHIFT, code:11, movetoworkspace, 2
bind = $mod SHIFT, code:12, movetoworkspace, 3
bind = $mod SHIFT, code:13, movetoworkspace, 4
bind = $mod SHIFT, code:14, movetoworkspace, 5
bind = $mod SHIFT, code:15, movetoworkspace, 6
bind = $mod SHIFT, code:16, movetoworkspace, 7
bind = $mod SHIFT, code:17, movetoworkspace, 8
bind = $mod SHIFT, code:18, movetoworkspace, 9
bind = $mod SHIFT, code:19, movetoworkspace, 10

# Workspace navigation (Super+arrows)
bind = $sup, RIGHT, workspace, e+1
bind = $sup, LEFT, workspace, e-1

# Move workspace between monitors (i3: Ctrl+Shift+greater/less)
bind = CTRL SHIFT, RIGHT, movecurrentworkspacetomonitor, r
bind = CTRL SHIFT, LEFT, movecurrentworkspacetomonitor, l

# Layout management (matching i3)
# i3: $mod+s = stacking → Hyprland: switch to master layout
bind = $mod, S, exec, hyprctl keyword general:layout master

# i3: $mod+w = tabbed → Hyprland: switch back to dwindle (tiling)
bind = $mod, W, exec, hyprctl keyword general:layout dwindle

# i3: $mod+e = toggle split → Hyprland: toggle split direction
bind = $mod, E, togglesplit,

# i3: $mod+v = split toggle
bind = $mod, V, togglesplit,

# Fullscreen (i3: $mod+f)
bind = $mod, F, fullscreen, 0

# Toggle floating (i3: $mod+Shift+space)
bind = $mod SHIFT, SPACE, togglefloating,

# Special workspace (scratchpad)
bind = $mod SHIFT, V, togglespecialworkspace,
bind = $mod SHIFT, S, movetoworkspace, special

# Scratchpad terminal (Super+Grave/backtick - like dropdown terminal)
bind = $sup, grave, exec, alacritty --class float --title scratchpad -e tmux

# Focus parent (i3: $mod+a) - cycle through windows in current workspace
bind = $mod, A, cyclenext,

# Resize mode (i3-style)
bind = $mod, R, submap, resize
submap = resize

# Resize bindings (vim keys)
binde = , H, resizeactive, -10 0
binde = , J, resizeactive, 0 10
binde = , K, resizeactive, 0 -10
binde = , L, resizeactive, 10 0

# Resize bindings (arrow keys)
binde = , LEFT, resizeactive, -10 0
binde = , DOWN, resizeactive, 0 10
binde = , UP, resizeactive, 0 -10
binde = , RIGHT, resizeactive, 10 0

# Exit resize mode
bind = , Return, submap, reset
bind = , ESCAPE, submap, reset
submap = reset

# Reload config (i3: $mod+Shift+c)
bind = $mod SHIFT, C, exec, hyprctl reload

# Restart (i3: $mod+Shift+r)
bind = $mod SHIFT, R, exec, hyprctl reload

# Exit (i3: $mod+Shift+e) - with confirmation dialog
bind = $mod SHIFT, E, exec, bash -c 'if echo -e "No\nYes, exit Hyprland" | wofi --dmenu --prompt "Exit Hyprland?" | grep -q "Yes"; then hyprctl dispatch exit; fi'

# Lock screen (i3: $mod+Shift+q)
bind = $mod SHIFT, Q, exec, swaylock -f -c 000000

# Audio controls (binde = repeat when held)
binde = , XF86AudioRaiseVolume, exec, pactl set-sink-volume @DEFAULT_SINK@ +10%
binde = , XF86AudioLowerVolume, exec, pactl set-sink-volume @DEFAULT_SINK@ -10%
bind = , XF86AudioMute, exec, pactl set-sink-mute @DEFAULT_SINK@ toggle
bind = , XF86AudioMicMute, exec, pactl set-source-mute @DEFAULT_SOURCE@ toggle

# Brightness controls (binde = repeat when held)
binde = , XF86MonBrightnessDown, exec, brightnessctl set 5%-
binde = , XF86MonBrightnessUp, exec, brightnessctl set +5%

# Media controls
bind = , XF86AudioPlay, exec, playerctl play-pause
bind = , XF86AudioNext, exec, playerctl next
bind = , XF86AudioPrev, exec, playerctl previous

# Screenshot (Wayland - copies to clipboard AND saves file)
bind = , Print, exec, grim -g "$(slurp)" - | tee ~/Pictures/Screenshots/$(date +'%Y-%m-%d-%H-%M-%S_screenshot.png') | wl-copy
bind = SHIFT, Print, exec, grim - | tee ~/Pictures/Screenshots/$(date +'%Y-%m-%d-%H-%M-%S_screenshot.png') | wl-copy

# Application launchers (Super key combos)
bind = $sup, N, exec, sh $HOME/.launch_notion.sh
bind = $sup, L, exec, sh $HOME/.launch_logseq.sh
bind = $sup, Y, exec, sh $HOME/.launch_youtube.sh
bind = $sup, I, exec, sh $HOME/.launch_instagram.sh
bind = $sup, M, exec, sh $HOME/.launch_music.sh
bind = $sup, F, exec, sh $HOME/.launch_googlefi.sh
bind = $sup+SHIFT, W, exec, sh $HOME/.launch_whatsapp.sh
bind = $sup, B, exec, sh $HOME/.launch_bible.sh
bind = $sup, C, exec, sh $HOME/.launch_chatgpt.sh
bind = $sup, A, exec, sh $HOME/.launch_audacity.sh
bind = $sup, E, exec, sh $HOME/.launch_businessmail.sh
bind = $sup, G, exec, sh $HOME/.launch_gmail.sh
bind = $sup, O, exec, sh $HOME/.launch_github.sh
bind = $sup, K, exec, sh $HOME/.launch_googlekeep.sh
bind = $sup, P, exec, sh $HOME/.launch_protonmail.sh
bind = $sup, D, exec, sh $HOME/.launch_drive.sh

# Bluetooth toggle (Shift+F10)
bind = SHIFT, F10, exec, bash -c 'if lsmod | grep -q btusb; then sudo modprobe -r btusb && notify-send "Bluetooth Disabled" "Hardware powered off"; else sudo modprobe btusb && sudo systemctl restart bluetooth && notify-send "Bluetooth Enabled" "Hardware ready"; fi'

# ============================================
# AUTOSTART APPLICATIONS
# ============================================

# Network manager
exec-once = nm-applet

# Notification daemon (Wayland)
exec-once = mako

# Clipboard history daemon
exec-once = wl-paste --type text --watch cliphist store
exec-once = wl-paste --type image --watch cliphist store

# Status bar (Wayland)
exec-once = waybar

# Wallpaper (Wayland) - Catppuccin tinted
exec-once = swaybg -i ~/Pictures/wallpapers/giraffe-manor-catppuccin.jpg -m fill

# Screen idle and lock (Wayland)
exec-once = swayidle -w timeout 1800 'swaylock -f -c 000000' timeout 1830 'hyprctl dispatch dpms off' resume 'hyprctl dispatch dpms on' before-sleep 'swaylock -f -c 000000'

# Input gestures
exec-once = libinput-gestures

# Applications
exec-once = protonmail-bridge -g
exec-once = xdg-settings set default-web-browser firefox.desktop

# Scripts
exec-once = bash ~/.avoid_sleeping_while_streaming.sh
exec-once = bash -c 'while true; do bash ~/.battery_check.sh; sleep 90; done'

# Psmouse fix
exec-once = sudo modprobe -r psmouse && sudo modprobe psmouse

# ========================================
# REMOTE DESKTOP MODE (for RustDesk)
# ========================================
# Disables ALL local keybindings so they pass through to RustDesk
#
# Usage:
#   Press SUPER+SHIFT+R to enter Remote Desktop Mode
#   All keyboard shortcuts now go to RustDesk (no local keybinds active)
#   Press SUPER+SHIFT+R again to exit and restore local keybinds
#
# Toggle Remote Desktop Mode (enter submap)
# When you press SUPER+SHIFT+R, enter remote_desktop submap (disables all local keybinds)
bind = $sup+SHIFT, R, submap, remote_desktop

# Remote Desktop Mode submap - only SUPER+SHIFT+R works to exit
submap = remote_desktop
# Exit remote desktop mode and restore all keybinds
bind = $sup+SHIFT, R, submap, reset
submap = reset
